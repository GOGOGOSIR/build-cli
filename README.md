# build-cli

<p align='left'>
  <a href='https://www.npmjs.com/package/build-cli'>
    <img src="https://img.shields.io/npm/v/build-cli?color=41b883&label=npm" />
  </a>
  <a href='https://www.npmjs.com/package/build-cli'>
    <img src="https://img.shields.io/npm/l/build-cli?label=npm" />
  </a>
</p>

ğŸ¦„ é¡¹ç›®çš„æ‰“åŒ…è„šæœ¬

<img src="./static/eg.gif" />

## èƒŒæ™¯

å½“ä½¿ç”¨å¾®å‰ç«¯å°†ä¸€ä¸ªåºå¤§çš„é¡¹ç›®æ‹†åˆ†æˆä¸€ä¸ªä¸ªå°çš„åº”ç”¨çš„æ—¶å€™ï¼Œéš¾å…ä¸äº†åº”ç”¨ä¹‹é—´é¡¹ç›®ä¾èµ–çš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š1ã€ å°†é¡¹ç›®ç›¸äº’ä¾èµ–çš„éƒ¨åˆ†æŠ½ç¦»ä¸€ä¸ª npm åŒ…ï¼Œæ¯ä¸ªåº”ç”¨å®‰è£…å³å¯ï¼›2ã€å°†è¢«ä¾èµ–é¡¹ç›®çš„è·¯å¾„é…ç½®åœ¨ alias ï¼ˆä¾‹å¦‚ï¼šåœ¨ ```webpack``` ä¸­ aliasï¼‰ä¸­ï¼›å¦‚æœé‡‡ç”¨æ–¹æ¡ˆäºŒçš„è¯ï¼Œåœ¨é¡¹ç›®æ‰“åŒ…æ—¶ï¼Œå°±å¿…é¡»æŠŠæœ¬åœ°æ‰€ä¾èµ–çš„é¡¹ç›®åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°çš„è®°å½•ï¼Œæ‰èƒ½æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ã€‚è¿™æ— ç–‘å¢åŠ äº†è®¸å¤šå·¥ä½œé‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œ**build-cli** å­•è‚²è€Œç”Ÿã€‚

## æ‰§è¡Œæµç¨‹

- **æŸ¥æ‰¾æ‰€ä¾èµ–çš„é¡¹ç›®** åœ¨ç”¨æˆ·çš„å·¥ä½œåŒºæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨æ‰€ä¾èµ–çš„é¡¹ç›®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šä¸»åŠ¨ä»è¿œç«¯ä»“åº“å…‹éš†ä¸‹æ¥ï¼Œå¹¶ä¸ºå…¶å®‰è£…å¥½ä¾èµ–
- **ç”¨æˆ·å‹¾é€‰æ‰“åŒ…é…ç½®** è®©ç”¨æˆ·è‡ªå®šä¹‰å…¶æ‰“åŒ…çš„é…ç½®é¡¹
- **æ„å»ºæ‰“åŒ…** é¦–å…ˆä¼šæŠŠæ‰€ä¾èµ–çš„é¡¹ç›®åˆ‡åˆ°ç›®æ ‡åˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°çš„ä»£ç ï¼Œç„¶åæ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œå¦‚æœæ˜¯æ„å»ºæµ‹è¯•ç¯å¢ƒçš„åŒ…ï¼Œåœ¨æ‰“åŒ…æˆåŠŸåä¼šåˆ›å»ºä¸€ä¸ª **test-projectName** çš„åˆ†æ”¯å’Œä¸€ä¸ª **projectName.zip** çš„å‹ç¼©åŒ…ã€‚å¦‚æœæ˜¯æ„å»ºé¢„å‘å¸ƒç¯å¢ƒçš„åŒ…ï¼Œåœ¨æ‰“åŒ…æˆåŠŸåä¼šåˆ›å»ºä¸€ä¸ª **staging** çš„åˆ†æ”¯å’Œä¸€ä¸ª **projectName.zip** çš„å‹ç¼©åŒ…ã€‚
- **é‡Šæ”¾è¢« stash çš„è®°å½•** å¦‚æœæ‰€ä¾èµ–çš„é¡¹ç›®çš„ git å·¥ä½œåŒºæ˜¯ä¸å¹²å‡€çš„ï¼Œåˆ™ä¼šå…ˆ stash æ‰ï¼Œç„¶ååœ¨åˆ‡æ¢åˆ†æ”¯ï¼Œå½“è„šæœ¬æ‰§è¡Œå®Œæ‰“åŒ…è„šæœ¬åï¼Œä¼šè‡ªåŠ¨æŠŠæ‰€ä¾èµ–çš„é¡¹ç›®åˆ‡å›ä¹‹å‰çš„åˆ†æ”¯ï¼Œå¹¶é‡Šæ”¾è¢« stash çš„è®°å½•

## å®‰è£…

```bash
// npm
npm install build-cli -D

// yarn
yarn add build-cli -D
```

## ä½¿ç”¨

- åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª ```.build-cli.js``` æ–‡ä»¶ï¼š

```js
const pkg = require('./package.json')

module.exports = {
  projectName: pkg.name,
  distName: 'dist', // è¿™ä¸ªé…ç½®æ ¹æ®ä½ é¡¹ç›®çš„webpackçš„outputè€Œå®š
  dependencies: [{
    remoteUrl: 'è¯·å¡«å†™é¡¹ç›®çš„gitåœ°å€',
    defaultBranch: 'master'
  }],
  buildCommand: {
    test: 'xxxxx', // æ‰“åŒ…æµ‹è¯•ç¯å¢ƒçš„å‘½ä»¤
    staging: 'xxx' // æ‰“åŒ…é¢„å‘å¸ƒç¯å¢ƒçš„å‘½ä»¤
  }
}
```

- åœ¨ ```package.json``` ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```
"scripts": {
  "build": "build-cli"
}
```

- é…ç½® dependenciesWorkspace æ‰€ç»‘å®šçš„ node ç¯å¢ƒçš„å˜é‡

æ–¹å¼ä¸€ï¼š


æ‰¾åˆ° ```.zshrc``` æ–‡ä»¶å¹¶é…ç½®ï¼š

ç”¨ä¾‹ï¼šå°†BUILD_CLI_WORKSPACEæŒ‡å®šä¸ºDesktop

```
export BUILD_CLI_WORKSPACE=Desktop
```

æ–¹å¼äºŒï¼š

1. å®‰è£… ```dotenv-cli```

```dash
// npm
npm install dotenv-cli -D

// yarn
yarn add dotenv-cli -D
```

2. åœ¨æ ¹ç›®å½•æ–°å¢ ```.env.workspace```

```
BUILD_CLI_WORKSPACE=Desktop
```

3. é…ç½® ```.gitignore```

```
.env.workspace
```
4. é…ç½® ```package.json```
```json
"scripts": {
  "build": "dotenv -e .env.workspace build-cli"
}
```

## å‚æ•°é…ç½®

**projectName**
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```true```

é¡¹ç›®åç§°

**distName**
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```true```

æ‰“åŒ…åçš„ç›®å½•å

**dependenciesWorkspace**
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```false```
é»˜è®¤å€¼ï¼š ```BUILD_CLI_WORKSPACE```

ä¸€ä¸ª node çš„å…¨å±€å˜é‡åï¼Œç”¨æˆ·å­˜æ”¾æ‰€ä¾èµ–é¡¹ç›®çš„å·¥ä½œåŒºåœ°å€

**dependencies**
ç±»å‹ï¼š```Array<DepType>```
æ˜¯å¦å¿…å¡«: ```false```
é»˜è®¤å€¼ï¼š ```[]```

æ‰€ä¾èµ–çš„é¡¹ç›®çš„ä¸€äº›é…ç½®

ç”¨ä¾‹:

```json
{
  dependencies: [{
    remoteUrl: 'xxxx',
    defaultBranch: 'master',
    packageManager: 'yarn',
    installCommand: ['npm link xxx']
  }]
}
```
DepType ç±»å‹è¯´æ˜ï¼š

remoteUrl
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```true```
é»˜è®¤å€¼ï¼š ```''```

git ä»“åº“åœ°å€

defaultBranch
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```false```
é»˜è®¤å€¼ï¼š ```''```

é»˜è®¤é€‰ä¸­çš„åˆ†æ”¯å

git ä»“åº“åœ°å€

packageManager
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```false```
é»˜è®¤å€¼ï¼š ```''```

åœ¨å®‰è£…ä¾èµ–æ—¶çš„åŒ…ç®¡ç†å™¨ï¼Œå¦‚æœç”¨æˆ·ä¸ä¼ å…¥è¯¥å€¼ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ yarn, å¦‚æœç”¨æˆ·æ²¡æœ‰å®‰è£… yarn åˆ™ä½¿ç”¨ npm

installCommand
ç±»å‹ï¼š```Array<string>```
æ˜¯å¦å¿…å¡«: ```false```
é»˜è®¤å€¼ï¼š ```[]```

åœ¨æ‰§è¡Œå®Œ install åï¼Œè¿è¡Œçš„å…¶ä»–å‘½ä»¤ï¼Œä¾‹å¦‚ç”¨ä¾‹ä¸­çš„ npm link xxx

**buildCommand**
ç±»å‹ï¼š```Array<CommandType>```
æ˜¯å¦å¿…å¡«: ```false```
é»˜è®¤å€¼ï¼š ```[{ test: 'npm run build:test', staging: 'npm run build:prod'}]```

æ‰“åŒ…å‘½ä»¤çš„é…ç½®

CommandType å±æ€§è¯´æ˜

test
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```true```
é»˜è®¤å€¼ï¼š ```npm run build:test```

æ‰“åŒ…æµ‹è¯•ç¯å¢ƒçš„å‘½ä»¤è¡Œ

staging
ç±»å‹ï¼š```String```
æ˜¯å¦å¿…å¡«: ```true```
é»˜è®¤å€¼ï¼š ```npm run build:prod```

æ‰“åŒ…é¢„å‘å¸ƒç¯å¢ƒçš„å‘½ä»¤è¡Œ

## Q&A

1. å› ä¸º node ç‰ˆæœ¬çš„åŸå› ï¼Œåœ¨é¡¹ç›®å®‰è£…ä¾èµ–æ—¶æŠ¥é”™

è¿™ä¸ªå°±å¿…é¡»ç”±ç”¨æˆ·è‡ªå·±åˆ‡æ¢è‡³åˆé€‚çš„ node ç‰ˆæœ¬ï¼Œæ‰‹åŠ¨ install ä¾èµ–

2. ä¸ºä»€ä¹ˆ **dependenciesWorkspace** æ‰€ç»‘å®šçš„æ˜¯ node çš„ç¯å¢ƒå˜é‡å

ä¸ºäº†å‡å°‘å›¢é˜Ÿæˆå‘˜å› ä¸ºå­˜æ”¾é¡¹ç›®çš„ç›®å½•åœ°å€çš„ä¸åŒè€Œé€ æˆä¸å¿…è¦çš„å†²çªã€‚

3. å¦‚ä½•è‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„è·¯å¾„

```
"scripts": {
  "build": "build-cli -c scripts/xxx.js"
}
```
